#!/usr/bin/env bash
# poor man's i3blocks, it's all I need really
# see: man swaybar-protocol

set -e

echo '{"version": 1}'
echo "["
while true; do

wrap() {
	echo {"\"background\"": "\"#000000\"",\""color\"":"\"#ffffff\"","\"full_text\"":"\"$1\""}
}

date=$(wrap "$(date '+%A %d.%m.%y, %H:%M')")

if [ "$(dunstctl is-paused)" = "true" ]; then
	notifications=$(wrap "ğŸ”•")
else
	notifications=$(wrap "ğŸ””")
fi

if [ "$HOSTNAME" = "carb" ]; then
	if [ "$(cat /sys/class/power_supply/BAT0/status)" = "Discharging" ]; then
		bat="ğŸ”‹ $(cat /sys/class/power_supply/BAT0/capacity)%"
	else
		bat="ğŸ’« $(cat /sys/class/power_supply/BAT0/capacity)%"
	fi

	if [ "$(cat /sys/class/power_supply/BAT0/status)" = "Discharging" ] && [ "$(cat /sys/class/power_supply/BAT0/capacity)" -lt "25" ]; then
		echo -n '[{"background": "#000000","color":"#ff0000","full_text":"  '
	else
		echo -n '[{"background": "#000000","color":"#36f8ff","full_text":"  '
	fi
fi

cpu() {
}

disk() {
	used=$(df -h | awk '/\/$/ {print $5}')
	echo "Disk use: $used"
}

scratches=$(scratches)
if [ "$scratches" -gt "0" ]; then
	scratches=$(wrap "ğŸ™ˆ $scratches")
else
	scratches=$(wrap "ğŸ™‰")
fi

sessions=$(wrap "ğŸ–¥ï¸ $(tmux ls | wc -l || 0)")
cpu=$(wrap $(cpu))
disk=$(wrap $(disk))

case $HOSTNAME in
	carb) echo -n "$bat   $notifications $sessions $scratches $disk $cpu    $date";;
 	yharnam) echo -n "$notifications, $sessions, $scratches, $disk, $cpu,   $date";;
esac
echo -n '],'
echo
sleep 2
done
