#!/usr/bin/env bash
# poor man's i3blocks, it's all I need really
# see: man swaybar-protocol
echo '{"version": 1}'
echo "["
while true; do

date=$(date '+%a %d.%m   %H:%M')

if [ "$(dunstctl is-paused)" = "true" ]; then
	notifications="ğŸ”•"
else
	notifications="ğŸ””"
fi

if [ "$(cat /sys/class/power_supply/BAT0/status)" = "Discharging" ]; then
	bat="ğŸ”‹ $(cat /sys/class/power_supply/BAT0/capacity)%"
else
	bat="ğŸ’« $(cat /sys/class/power_supply/BAT0/capacity)%"
fi

if [ "$(cat /sys/class/power_supply/BAT0/status)" = "Discharging" ] && [ "$(cat /sys/class/power_supply/BAT0/capacity)" -lt "25" ]; then
	echo -n '[{"background": "#000000","color":"#ff0000","full_text":"  '
else
	echo -n '[{"background": "#000000","color":"#36f8ff","full_text":"  '
fi

sessions="ğŸ–¥ï¸ $(tmux ls | wc -l || 0)"


case $HOSTNAME in
	carb) echo -n "$bat   $date $notifications $sessions";;
 	yharnam) echo -n "$date $notifications $sessions";;
esac
echo -n '  "}],'
echo
sleep 2
done
